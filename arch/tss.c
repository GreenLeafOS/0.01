/*===============================================================
 *                       tss.c
 *                	  TSS相关处理函数
 ===============================================================*/
#include "include/table.h"

TSS tss;
u16 tss_sel;

/************************************************************************/
/*							初始化
/*                           init
/************************************************************************/
void tss_init()
{
	int i = gdt_add(desc_create((u32)&tss,sizeof(tss)-1,DA_386TSS));
	gdt_load();
	tss.iobase = sizeof(tss);
	tss_sel = gdt_get_sel(i,0);
	tss_load(tss_sel);
}

/************************************************************************/
/*					 		加载 tss
/*                            tss
/************************************************************************/
void tss_load(u16 sel)
{
	__asm volatile(
			"mov %0,%%ax	\n"
			"ltr %%ax"
			: : "g"(sel)
			);
}
